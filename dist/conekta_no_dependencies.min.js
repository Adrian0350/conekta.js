/*!conekta.js v0.1.0 | 2013- Conekta | https://github.com/conekta/conekta.js/blob/master/LICENSE-MIT.txt
*/
!function(){}.call(this),function(){var a;a=null,window.Conekta={_helpers:{x_domain_post:function(a){var b,c;return c="POST",b="JSON",navigator.userAgent.match(/MSIE [6789]+/)?(b="JSONP",c="GET",a.url=(a.jsonp_url||a.url)+".js",a.data.auth_token=Conekta.getPublishableToken()):a.url=a.url+".json",a.data._js=!0,jQuery.ajax({url:"https://api.conekta.io/"+a.url,type:c,dataType:b,data:a.data,headers:{Authorization:'Token token="'+Conekta.getPublishableToken()+'"'},success:function(b){return!b||b.type&&b.message?a.error(b||{type:"api_error",message:"Something went wrong on Conekta's end"}):a.success(b)},error:function(){return a.error({type:"api_error",message:"Something went wrong, possibly a connectivity issue"})}})},log:function(a){return console&&console.log?console.log(a):void 0}}},Conekta.setPublishableToken=function(b){"string"==typeof b&&b.match(/^[a-zA-Z0-9]*$/)&&b.length>=20&&b.length<30?a=b:Conekta._helpers.log("Unusable public token: "+b)},Conekta.getPublishableToken=function(){return a}}.call(this),function(){var a;a=function(a){var b;return b={},a.find("input[data-conekta]").each(function(a,c){var d,e,f,g,h,i,j,k,l;for(d=$(c),j=d.val(),f=d.data("conekta").replace(/\]/,"").replace(/\-/,"_").split(/\[/),h=b,g=null,k=0,l=f.length;l>k;k++)e=f[k],h[e]||(h[e]={}),i=h,g=e,h=h[e];return i[g]=j}),b},Conekta.charge={},Conekta.charge.create=function(b,c,d){return"function"!=typeof c&&(c=Conekta._helpers.log),"function"!=typeof d&&(d=Conekta._helpers.log),jQuery&&b instanceof jQuery&&(b=a(b)),"object"==typeof b?(b._js=!0,Conekta._helpers.x_domain_post({jsonp_url:"charges/create",url:"charges",data:b,success:function(a){var b;return a&&a.card&&a.card.redirect_form?(0===jQuery("div#conekta_iframe_wrapper").length&&jQuery("body").append('<div id="conekta_iframe_wrapper" style="position: absolute; left: 50%;top:50%;"></div>'),b=new easyXDM.Socket({swf:"https://s3.amazonaws.com/conekta_api/flash/easyxdm.swf",remote:"https://api.conekta.io/iframe_proxy.html",container:"conekta_iframe_wrapper",props:{style:{width:"376px",height:"400px",position:"relative",left:"-188px","margin-top":"-200px","overflow-x":"hidden","overflow-y":"hidden"},scrolling:"no"},onMessage:function(a){var e;return e=JSON.parse(a),e.type&&e.message?d(e):c(e),b.destroy(),$("#conekta_iframe_wrapper").remove()}}),b.postMessage(JSON.stringify(a.card.redirect_form))):c(a)},error:d})):d({type:"invalid_request_error",message:"Supplied parameter 'charge' is not a javascript object"})}}.call(this),function(){var a,b,c,d,e,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^36/,valid_length:[14]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[16]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16]}],e=function(a){var b,c,d,e,f,g;for(d=0,g=a.split("").reverse(),c=e=0,f=g.length;f>e;c=++e)b=g[c],b=+b,c%2?(b*=2,d+=10>b?b:b-9):d+=b;return 0===d%10},d=function(a,b){var c;return c=a.length,f.call(b.valid_length,c)>=0},a=["visa","mastercard"],c=function(c){var d,e,g,h,i;for(i=function(){var c,e,g,h;for(h=[],c=0,e=b.length;e>c;c++)d=b[c],g=d.name,f.call(a,g)>=0&&h.push(d);return h}(),g=0,h=i.length;h>g;g++)if(e=i[g],c.match(e.pattern))return e;return null},Conekta.card={},Conekta.card.getBrand=function(a){var b;return"string"==typeof a?a=a.replace(/[ -]/g,""):"number"==typeof a&&(a=toString(a)),b=c(a),b&&b.name?b.name:null},Conekta.card.validateCVC=function(a){return"number"==typeof a&&a>=0&&1e4>a||"string"==typeof a&&a.match(/^[\d]{3,4}$/)?!0:!1},Conekta.card.validateExpiry=function(a,b){return"string"==typeof a&&a.match(/^[\d]{1,2}$/)&&(a=parseInt(a)),b.match(/^([\d]{2,2}|20[\d]{2,2})$/)&&("string"==typeof b&&b.match(/^([\d]{2,2})$/)&&(b="20"+b),b=parseInt(b)),"number"==typeof a&&a>0&&13>a&&"number"==typeof b&&b>2012&&2050>b?Date.parse(a+"/"+new Date(b,a,0).getDate()+"/"+b)>Date.now():!1},Conekta.card.validateNumber=function(a){var b,f,g;return"string"==typeof a?a=a.replace(/[ -]/g,""):type("number"===a)&&(a=toString(a)),b=c(a),g=!1,f=!1,null!=b&&(g=e(a),f=d(a,b)),g&&f}}.call(this);